# 3. コーディングルール

## 基本的な記述方法

- ShellCheckのルールに従います。
  - ただし、ShellCheckではうまく判別できないものがあります。例えばsourceでユーティリティ関数をロードする場合がそれにあたります。その場合は以下のようにShellCheckの番号を指定して無効にします。
    ```bash
    # load utils
    # shellcheck disable=SC1091
    # shellcheck source=utils.sh
    source "${DIRNAME}/utils.sh"
    ```
- 以下に説明する内容についてもShellCheckに含まれているものもあります。

## フォーマット

- インデントは2スペースとします。これはVSCodeの自動フォーマットで適用されます。
- 1行の最大文字数は特に強制しませんが、80文字以内で収まるように意識してください。文字数の長さよりも可読性を重視してコードを記述します。
  - 長い文字列の場合はヒアドキュメントや埋め込み改行を利用します。
    ```bash
    # ヒアドキュメントの利用
    cat <<END
    I am an exceptionally long
    string.
    END

    # 埋め込み改行
    long_string="I am an exceptionally
    long string."
    ```
  - 例えば長いパイプラインを記述する場合は以下のように記述すると可読性が高いです。
    ```bash
    # 1行に全て収まる場合
    command1 | command2

    # 長いコマンド
    command1 \
    | command2 \
    | command3 \
    | command4
    ```
- コマンドのセパレータとしてセミコロン(`;`)ではなく改行を利用します。ただし、ループや条件式を記述する場合は除きます。
- ファイルの最後は空白行を挿入します。これはVSCodeの自動フォーマットで適用されます。

## シバン

- シバン(`shebang`)はファイルの1行目に以下のように記述します。
  ```bash
  #!/usr/bin/env bash
  ```
- 全ての環境において、`#!/bin/bash`が必ずしも正しいと限らないため上記のように設定します。

## 命名規則

- 全てスネークケース(単語をアンダーバー(`_`)で区切る)で命名します。
- シンプルかつわかりやすい命名を心がけましょう。(命名はソフトウェアの中で一番難しいとされています。)

### 変数名

- グローバル変数は全てアッパーケース(大文字)とします。ただし、環境変数や[予約変数](https://www.gnu.org/software/bash/manual/html_node/Shell-Variables.html)と衝突しないように気をつけましょう。
  ```bash
  XX_VAR1="$1"
  ```
- 関数内のローカル変数はローアケース(小文字)とします。
  ```bash
  xx_var1="$1"
  ```

### 関数名

- `function`キーワードを利用します。
- 関数は、必ず`動詞_名詞`のような名前にします。
  ```bash
  function do_something() {
    ...
  }
  ```

## 変数の扱い

- 変数を呼び出す際は`$var`ではなく`${var}`と記述します。ただし、予約変数である`$1`や`$#`などのポジショナルパラメータや`$?`などの特殊変数は除きます。
- 変数はダブルクォートで囲みます。これは新たに変数に代入する場合も同じです。
  - ただし、変数が整数リテラルを格納する場合はダブルクォートは不要です。
  ```bash
  echo "${xx_var1}"
  var2="$1"
  var3=42
  ```
- 関数で定義する変数は`local`キーワードを利用して、関数内でのみアクセス可能とします。
  - ポジショナルパラメータも必ず`local`キーワードを利用して命名した変数に格納します。このとき、`local`キーワードと
  - コマンド置換や値を直接代入する場合は、その処理に失敗したのにも関わらず0ステータスコードを返すことを避けるために`local`キーワードと変数代入は別で実施します。
  ```bash
  function do_something() {

  }
  ```
- 定義した変数はそのスクリプト内で必ず利用するようにします。

## コメント

### ヘッダーのコメント

- ヘッダーのコメントは以下のように設定します。これはコードスニペットから挿入することができます。
  ```bash
  #######################################
  # File:
  #   <filename>
  # Description:
  #   <description>
  # Globals:
  #   <global variables>
  # Arguments:
  #   <argument>
  # Outputs:
  #   <outputs>
  # Returns:
  #   <retuen code>: <description>
  #######################################
  ```
  - File: ファイル名
  - Description: スクリプトの説明
  - Globals: グローバル変数
  - Arguments: 引数。順番通り正しく記述します。
  - Outputs: このスクリプトを実行した際に出力されるファイルなどを記述します。
  - Returns: 終了コードとその説明を記述します。

### 関数のコメント

- 関数のコメントは以下のように設定します。これにより関数を呼び出した際に説明を表示することができます。これはコードスニペットから挿入することができます。
  ```bash
  ```
  - File: ファイル名
  - Description: スクリプトの説明
  - Globals: グローバル変数
  - Arguments: 引数。順番通り正しく記述します。
  - Outputs: このスクリプトを実行した際に出力されるファイルなどを記述します。
  - Returns: 終了コードとその説明を記述します。

### その他のコメント

- 自明な処理に対するコメントは不要ですが、パイプを利用したり、コマンドから何をしているか判断しづらい場合はコメントでその説明や背景を記述します
- 開発中であればTODOコメントを挿入します。
  ```bash
  # TODO: ディレクトリを走査し、不要なファイルを削除する
  ```

## ループ

## 条件式

## コマンド

### コマンド引数

- コマンド引数はなるべく省略文字を利用せず、その引数名全体を記述します。

### コマンド置換

### コマンド呼び出し

クオーとする
evalは利用しない

## ワイルドカード

## 配列

## 算術演算

letを利用しない
