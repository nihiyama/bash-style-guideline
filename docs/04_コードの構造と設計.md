# 4. コードの構造と設計

## ディレクトリ構成

## スクリプト構成

```bash
#!/usr/bin/env bash

#######################################
# File:
#   <filename>
# Description:
#   <description>
# Globals:
#   <global variables>
# Arguments:
#   <argument>
# Outputs:
#   <outputs>
# Returns:
#   <retuen code>: <description>
#######################################

# set for fail fast and loud
set -Eeuo pipefail

# global variables
VAR1="VAR1"
VAR2="$2"

DIRNAME="$(dirname "$0")"
FILENAME="$(basename "$0" .sh)"
LOGFILE="${DIRNAME}/${FILENAME}.log"

# load utils
# shellcheck disable=SC1091
# shellcheck source=utils.sh
source "${DIRNAME}/utils.sh"

# trap error
trap 'handle_error ${LINENO} ${LOGFILE};' ERR

#######################################
# Description:
#   <description>
# Globals:
#   <using global variables>
# Arguments:
#   <argument>
# Outputs:
#   <outputs>
# Returns:
#   <retuen code>: <description>
#######################################
function func1() {
  local var1="$1"
  local var2
  var2="var2"
  echo "${var1} ${var2}"
}

# main routine
func1 "var1"
echo "${VAR1}" "${VAR2}"

```

## Fail fast and loud (素早く声を上げて失敗する)

### シェルオプションの設定

#### `errexit`

#### `errtrace`

#### `nounset`

#### `pipefail`

### コマンドのステータスコードが0以外を返すものに対する対応

- コマンド置換した値を評価する

### シェルオプションの設定を受け入れられないとき

- PIPESTATUS
- リターンコード

## ログ出力

```bash

function logger() {
  local 
  local 
  local 
  command logger -sp user:
}

function logger_error() {

}

```

## エラーハンドリング

## 小さい関数を作成し、一つことを行う

## ユーティリティ関数を用意する

## 冪等性のある処理にする

## 他の高機能な言語の利用を考える

